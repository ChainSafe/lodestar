language: node_js
node_js:
  - "lts/*"

cache:
  yarn: true
  directories:
    - node_modules
    - packages/**/node_modules

install:
  - yarn
  - lerna bootstrap
  - lerna run --scope @chainsafe/eth2-types build # To ensure we run the latest version of eth2-types

jobs:
  include:

    # Lodestar package scripts
    - stage: Lodestar
      name: Lint and Check types
      script: lerna run --scope @chainsafe/lodestar check-types & lerna run --scope @chainsafe/lodestar lint
    -
      name: Unit Tests
      script: lerna run --scope @chainsafe/lodestar test:unit && lerna run --scope @chainsafe/lodestar codecov
    -
      name: E2e Tests
      script: lerna run --scope @chainsafe/lodestar test:e2e
    -
      name: Spec Tests
      script: lerna run --scope @chainsafe/lodestar test:spec

    # Eth2-types package scripts
    - stage: Eth2.0 Types
      name: Lint and Check types
      script: lerna run --scope @chainsafe/eth2-types check-types & lerna run --scope @chainsafe/eth2-types lint
    -
      name: Unit Tests
      script: lerna run --scope @chainsafe/eth2-types test:unit

before_deploy: yarn run --scope @chainsafe/lodestar build:docs

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GH_PAGES_TOKEN
  keep_history: true
  local_dir: packages/lodestar/docs
  on:
    branch: master
