language: node_js

cache:
  yarn: true
  directories:
    - node_modules

jobs:
  include:
    - stage: Lint and Check types
    - name: Lodestar
      node_js: "10"
      script: lerna run --scope @chainsafe/lodestar check-types & lerna run --scope @chainsafe/lodestar lint
    - name: Eth2.0 Types
      node_js: "10"
      script: lerna run --scope @chainsafe/eth2-types check-types & lerna run --scope @chainsafe/eth2-types lint

    - stage: Unit Tests
    - name: Lodestar
      node_js: "10"
      script: lerna run --scope @chainsafe/lodestar test:unit && lerna run --scope @chainsafe/lodestar codecov
    - name: Eth2.0 Types
      node_js: "10"
      script: lerna run --scope @chainsafe/eth2-types test:unit

    - stage: e2e Tests
    - name: Lodestar
      node_js: "10"
      script: lerna run --scope @chainsafe/lodestar test:e2e

    - stage: Spec Tests
    - name: Lodestar
      node_js: "10"
      script: lerna run --scope @chainsafe/lodestar test:spec


before_deploy: yarn run --scope @chainsafe/lodestar build:docs

deploy:
  provider: pages
  skip_cleanup: true
  github_token: $GH_PAGES_TOKEN
  keep_history: true
  local_dir: packages/lodestar/docs
  on:
    branch: master
