import {expect} from "chai";
import chai from "chai";
import chaiAsPromised from "chai-as-promised";
import {ELProof, ELStorageProof} from "../../../src/types.js";
import {isValidAccount, isValidStorageKeys} from "../../../src/utils/execution.js";

chai.use(chaiAsPromised);

describe("uitls/verification", () => {
  describe("isValidAccount", () => {
    it("should return true if account is valid", async () => {
      const address = "0xf97e180c050e5ab072211ad2c213eb5aee4df134";
      const stateRoot = Buffer.from("7c0f9a6f21d82c2d7690db7aa36c9938de11891071eed6e50ff8b06b5ae7018a", "hex");
      const proof: ELProof = {
        address: "0xf97e180c050e5ab072211ad2c213eb5aee4df134",
        accountProof: [
          "0xf90211a0d75d80002d4636855e0a3641ca53b495f0ccc3647af350ed23e86c4a9a21e089a0336a6387ac802d0d0433b65144610247ae2c4308b5f08683c641cddae571de52a0660dfa6b7ff69e6c4fe394e28c04097fd7c0d1e24d4d33731517ffeedeb73157a07d9a0299ad17ee459de4036254a522384bff041c32824761717abe82ed2250d5a0048f46242274fcfb2987dd9e1071335f966065322639b21a62a45ef9c4364707a06ab5c805de0350d7eb8641cfa3e985b58506529fc4f2175d018485b100fc8b57a030319f5efe302ba7d2cb593508af9e5b09eb8b961aac077f3e93e7c30d72b23aa08062584b94684d3585bc5cff5eb14ce8288cae9e6cca02d0145111fdeaec1ce8a05439df26136570dd0e3091ae189084e5445551e73de9032a589da1e858f493f7a074bfd76b5dfbaeb33d5caa06b0606eddfa9e2650b162a806e834535297a43f6fa0424651d0c1014d6575f418d84813d5fe61807162ae61eb9e2e29c099b62cff15a0717da7ec37ee17527323649684010b25b7fd7a53017645c92302aef90f66c696a0ce494b7c363d3ae8cca6fa9a6e60cf27b824f4e5acfa286b5b972d62e378d210a0861ef474c4cdeabd705bae1f3cc0a414129e7c2ad5c4fde69d5eea1757302046a0d8cc468f942d47cbc8349d221f958ae0505da2a4573db6a59859b743568cffcaa0fd6408c5b26aeba4d614d7043fd04082b9262e44dc966ad2c88add47b580325c80",
          "0xf90211a03aa3b28c58df0f2425569105f33d2b6f06682549a6086ca70e435e083bc86642a03177615c6149235d6c65e332ee7cc959b359d5dfdf9f6e3d29148d0f21aae9cba00357883423f1f4d1c5a21ef3c3bac9d87df1776aac962b1179c6ab4fa4c90eb1a0e5cdccfd420d7d0a115819805fc36372603d3a17ce1c8b3eb475d5c92f48090ea001b2c7e0885020c533a4bffc63735c409a118c774fa9927f56f54670de7a66bda054744b8c7e8ef96f30199b4038ea26467ea1803d205c2941e64a92a4b69f3457a0b3d5d0084572d60091cfd0e24a4ffba0b3fb53b53b9b6f91b0bb09714738ea46a052b016189553636fc18eaefd5ca00364dce332376a2988c936fa2527d15e215fa095f7f13944352c399335b7fe8971641db0e9922d9a91279e422f10cc75e16c26a0f5e63e53a4ab4157d7f3824747518d45567f1fab8fe1d41d569d33a97cb0e252a086928b3e984b0b92e24a8c27465e673e6c6336b7a9967b758e9a77ff92edb4e3a0bf10d9217a9bee1822e8f9edf82ac1d17725748fb9dcb0a16364da24bfbaa002a020eacf91465e7edefad05c0cc88c9209278edd213329f2f157969884985ecfaba02a195ddc556ebd100289d11ba8a6c54724bca5c93de0cec1e567f4f4537d952ca07237f43e3b1c16b5d7112fff823c08ffdd6891f4c9d2cb06b6300a0e3551f5faa0410d0b37714dbc23a76101f88a9b5876ab6d0d026391a2b456ea6bb245ef3c9680",
          "0xf90211a05cad7b7b1877521c405da0d0600be8f8dbfb6fe593fe7e0ff79b07cae70c0d44a04d7fa730f2cf4127121a4fbd783e97c372d00e2278f1475bd46df26ed1aba7e0a0d5368b792c687cfe7942dc1f9ece7941967d5a0b7d7c569c0dc3ec3c00cd8254a05c9f8de738470a1c962b38e95b32932afd26eae633f436960789acc024ac02c1a0b89a8e0ac2119c1ab9f40b233e2fb6878f7e41ccffa431c725d9e12c6589685ea059e306727f0c5c7ea0bc89ddbccd2d83ba5d9bc845a1be74e8677defcd0382a6a0a26aac0a6ff0f5e9e24eb6a0cc2d0813dd931d588941ce9ab4c74fd67bfe1b7fa07761bda76f79d20fc56a7f75d31295b3456fe001e12cb35bcd9cc12fdb5363faa07607ec1df2eca793d11953260a679a586793a1da4a55a2c8797741ee7ebd446ba0775277855b4d28645a7e3309d307616866e0df43f30255a5a8c0687430e0f0e4a0246affb48f550d0ea5f7b0ccdb14dd2b413356ae109d2522fd91379ecbe4c60ca0e82662910f79c26e9e5681ecbf79642fb02fe797ec7d17f23054543b00ef34dea0b6d81b91c67ac2db3e32d1556d6e6f699ce1cd7f2c0100be64c6264a0cd090d8a061a554d18934beddc75a67777326400ba6e254366d1ef59ee47bcfa91b3279e4a06f13cd680786a409ccbc9b84471b978a9efa02b09d1a64670ff6451a32d37b96a0e929123e076756fb6d43d668ddb199aca289b8c5869ec93842f1ef89c39c604f80",
          "0xf90211a028f2b0b77d46dd1a39fd0164d641b78e69ef29ce2ab676f02ee116d910b323cea0fcef9afa59d09cb714351378fd2c64becee3b1e9f09220687596670befb3a216a035d92a41b8e7e8c8f22abdce06272884cf1e53be96aa39a8aa722f97d0c8ea85a028b36435bf98dd8bac1edb6fc162737117320b000cd7609ec0d418e8dcad859ba062aaed887f8084e22f78779a671181c603cfeadc33629e4dc716fb4b8165d782a0180471c441c16211a8f2a3d9cc3859216965338971ece92d5386a972e6460c4ea0f3267b9acf4d4d47c8f563625c3f6a05e6d919312692945a28d44ada0408a8a4a0f157cf2e66744bb885c90b96b0ac50f45677262671224a4f754b1693930545b0a024db528d804e437bcbd74c6478d09fdcd95104bed7a110c01d89d4b24c283caea0f7ddca48dbfc34175322b37e35be0e10b7e8f0cf4b0f3c0c64ca4cc7409558a7a0fc03b71345f0f7c2c784b3e9bb8793c8358553eaa9811943af4b7e1ab827d64ca09db546d194941254910642424ed644cc13d27862d797faec1c73d72d4d1aff38a07ad68175fa8ccebae05aca2ac077b98f8906dfe1c01a526060d45948794badeba0383a06be4451de334f19162fd2f2b3a01ccaa318f0b19f6053c7f6274702a92ea0c92e0b54e5c7e5f6f18e0aa9762e09e911f0f519654b945103d517154125e695a0dcf537bda42520ce6670c2f3fb546ea12d28518f06310da26a9df887a1fc2a4880",
          "0xf90131a02fc4b4a237a100d29804e54134a3f590fe14cfc5932cf0d7db7d10b7c19359a580a07fb3394fdb1dc6cb6ee6bf74e16772783361840df5878b10284ef41f457a9cdda0b5d3f9bd4f88da36a3fbb68526053d7394f35411433bd88799510ce8a51e08dea0700e6a715dd6d428d31cbc9543cf768212e07692a79bd560e56d4f9547f3b6fb8080a0b295e4bf173f6a21ab742c03976070c3ba873b5fe457831de8411bf5ca988d08a057c069ca8e65fea0a889e16e770a7cc4f3125a35820deb3f0e6f8ae22e08d2eba0781511eba2101b49120073b03e24e79a3cdb0a02ee2d948e05a99a8b3b4145a4a011504843006186cba62c7f5563b3aee69c9f0325d6aadddc4c7c5ea246e50772a0ec6a3ac8944ef87fd684400258ef36a89194599884b606b032bedb29f42bcd008080808080",
          "0xf8729e31610ff568919eaebec883afe43d94f9558d9c666ca54b3d3bfef2311d37b851f84f0c8b034f248d17939c513a7e80a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
        ],
        balance: "0x34f248d17939c513a7e80",
        codeHash: "0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
        nonce: "0xc",
        storageHash: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
        storageProof: [],
      };

      await expect(
        isValidAccount({
          proof,
          address,
          stateRoot,
        })
      ).eventually.to.be.true;
    });

    it("should fail with error if proof is valid but address is wrong", async () => {
      const address = "0xe97e180c050e5ab072211ad2c213eb5aee4df134";
      const stateRoot = Buffer.from("7c0f9a6f21d82c2d7690db7aa36c9938de11891071eed6e50ff8b06b5ae7018a", "hex");
      const proof: ELProof = {
        address: "0xf97e180c050e5ab072211ad2c213eb5aee4df134",
        accountProof: [
          "0xf90211a0d75d80002d4636855e0a3641ca53b495f0ccc3647af350ed23e86c4a9a21e089a0336a6387ac802d0d0433b65144610247ae2c4308b5f08683c641cddae571de52a0660dfa6b7ff69e6c4fe394e28c04097fd7c0d1e24d4d33731517ffeedeb73157a07d9a0299ad17ee459de4036254a522384bff041c32824761717abe82ed2250d5a0048f46242274fcfb2987dd9e1071335f966065322639b21a62a45ef9c4364707a06ab5c805de0350d7eb8641cfa3e985b58506529fc4f2175d018485b100fc8b57a030319f5efe302ba7d2cb593508af9e5b09eb8b961aac077f3e93e7c30d72b23aa08062584b94684d3585bc5cff5eb14ce8288cae9e6cca02d0145111fdeaec1ce8a05439df26136570dd0e3091ae189084e5445551e73de9032a589da1e858f493f7a074bfd76b5dfbaeb33d5caa06b0606eddfa9e2650b162a806e834535297a43f6fa0424651d0c1014d6575f418d84813d5fe61807162ae61eb9e2e29c099b62cff15a0717da7ec37ee17527323649684010b25b7fd7a53017645c92302aef90f66c696a0ce494b7c363d3ae8cca6fa9a6e60cf27b824f4e5acfa286b5b972d62e378d210a0861ef474c4cdeabd705bae1f3cc0a414129e7c2ad5c4fde69d5eea1757302046a0d8cc468f942d47cbc8349d221f958ae0505da2a4573db6a59859b743568cffcaa0fd6408c5b26aeba4d614d7043fd04082b9262e44dc966ad2c88add47b580325c80",
          "0xf90211a03aa3b28c58df0f2425569105f33d2b6f06682549a6086ca70e435e083bc86642a03177615c6149235d6c65e332ee7cc959b359d5dfdf9f6e3d29148d0f21aae9cba00357883423f1f4d1c5a21ef3c3bac9d87df1776aac962b1179c6ab4fa4c90eb1a0e5cdccfd420d7d0a115819805fc36372603d3a17ce1c8b3eb475d5c92f48090ea001b2c7e0885020c533a4bffc63735c409a118c774fa9927f56f54670de7a66bda054744b8c7e8ef96f30199b4038ea26467ea1803d205c2941e64a92a4b69f3457a0b3d5d0084572d60091cfd0e24a4ffba0b3fb53b53b9b6f91b0bb09714738ea46a052b016189553636fc18eaefd5ca00364dce332376a2988c936fa2527d15e215fa095f7f13944352c399335b7fe8971641db0e9922d9a91279e422f10cc75e16c26a0f5e63e53a4ab4157d7f3824747518d45567f1fab8fe1d41d569d33a97cb0e252a086928b3e984b0b92e24a8c27465e673e6c6336b7a9967b758e9a77ff92edb4e3a0bf10d9217a9bee1822e8f9edf82ac1d17725748fb9dcb0a16364da24bfbaa002a020eacf91465e7edefad05c0cc88c9209278edd213329f2f157969884985ecfaba02a195ddc556ebd100289d11ba8a6c54724bca5c93de0cec1e567f4f4537d952ca07237f43e3b1c16b5d7112fff823c08ffdd6891f4c9d2cb06b6300a0e3551f5faa0410d0b37714dbc23a76101f88a9b5876ab6d0d026391a2b456ea6bb245ef3c9680",
          "0xf90211a05cad7b7b1877521c405da0d0600be8f8dbfb6fe593fe7e0ff79b07cae70c0d44a04d7fa730f2cf4127121a4fbd783e97c372d00e2278f1475bd46df26ed1aba7e0a0d5368b792c687cfe7942dc1f9ece7941967d5a0b7d7c569c0dc3ec3c00cd8254a05c9f8de738470a1c962b38e95b32932afd26eae633f436960789acc024ac02c1a0b89a8e0ac2119c1ab9f40b233e2fb6878f7e41ccffa431c725d9e12c6589685ea059e306727f0c5c7ea0bc89ddbccd2d83ba5d9bc845a1be74e8677defcd0382a6a0a26aac0a6ff0f5e9e24eb6a0cc2d0813dd931d588941ce9ab4c74fd67bfe1b7fa07761bda76f79d20fc56a7f75d31295b3456fe001e12cb35bcd9cc12fdb5363faa07607ec1df2eca793d11953260a679a586793a1da4a55a2c8797741ee7ebd446ba0775277855b4d28645a7e3309d307616866e0df43f30255a5a8c0687430e0f0e4a0246affb48f550d0ea5f7b0ccdb14dd2b413356ae109d2522fd91379ecbe4c60ca0e82662910f79c26e9e5681ecbf79642fb02fe797ec7d17f23054543b00ef34dea0b6d81b91c67ac2db3e32d1556d6e6f699ce1cd7f2c0100be64c6264a0cd090d8a061a554d18934beddc75a67777326400ba6e254366d1ef59ee47bcfa91b3279e4a06f13cd680786a409ccbc9b84471b978a9efa02b09d1a64670ff6451a32d37b96a0e929123e076756fb6d43d668ddb199aca289b8c5869ec93842f1ef89c39c604f80",
          "0xf90211a028f2b0b77d46dd1a39fd0164d641b78e69ef29ce2ab676f02ee116d910b323cea0fcef9afa59d09cb714351378fd2c64becee3b1e9f09220687596670befb3a216a035d92a41b8e7e8c8f22abdce06272884cf1e53be96aa39a8aa722f97d0c8ea85a028b36435bf98dd8bac1edb6fc162737117320b000cd7609ec0d418e8dcad859ba062aaed887f8084e22f78779a671181c603cfeadc33629e4dc716fb4b8165d782a0180471c441c16211a8f2a3d9cc3859216965338971ece92d5386a972e6460c4ea0f3267b9acf4d4d47c8f563625c3f6a05e6d919312692945a28d44ada0408a8a4a0f157cf2e66744bb885c90b96b0ac50f45677262671224a4f754b1693930545b0a024db528d804e437bcbd74c6478d09fdcd95104bed7a110c01d89d4b24c283caea0f7ddca48dbfc34175322b37e35be0e10b7e8f0cf4b0f3c0c64ca4cc7409558a7a0fc03b71345f0f7c2c784b3e9bb8793c8358553eaa9811943af4b7e1ab827d64ca09db546d194941254910642424ed644cc13d27862d797faec1c73d72d4d1aff38a07ad68175fa8ccebae05aca2ac077b98f8906dfe1c01a526060d45948794badeba0383a06be4451de334f19162fd2f2b3a01ccaa318f0b19f6053c7f6274702a92ea0c92e0b54e5c7e5f6f18e0aa9762e09e911f0f519654b945103d517154125e695a0dcf537bda42520ce6670c2f3fb546ea12d28518f06310da26a9df887a1fc2a4880",
          "0xf90131a02fc4b4a237a100d29804e54134a3f590fe14cfc5932cf0d7db7d10b7c19359a580a07fb3394fdb1dc6cb6ee6bf74e16772783361840df5878b10284ef41f457a9cdda0b5d3f9bd4f88da36a3fbb68526053d7394f35411433bd88799510ce8a51e08dea0700e6a715dd6d428d31cbc9543cf768212e07692a79bd560e56d4f9547f3b6fb8080a0b295e4bf173f6a21ab742c03976070c3ba873b5fe457831de8411bf5ca988d08a057c069ca8e65fea0a889e16e770a7cc4f3125a35820deb3f0e6f8ae22e08d2eba0781511eba2101b49120073b03e24e79a3cdb0a02ee2d948e05a99a8b3b4145a4a011504843006186cba62c7f5563b3aee69c9f0325d6aadddc4c7c5ea246e50772a0ec6a3ac8944ef87fd684400258ef36a89194599884b606b032bedb29f42bcd008080808080",
          "0xf8729e31610ff568919eaebec883afe43d94f9558d9c666ca54b3d3bfef2311d37b851f84f0c8b034f248d17939c513a7e80a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
        ],
        balance: "0x34f248d17939c513a7e80",
        codeHash: "0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
        nonce: "0xc",
        storageHash: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
        storageProof: [],
      };

      await expect(
        isValidAccount({
          proof,
          address,
          stateRoot,
        })
      ).rejectedWith("Invalid proof provided");
    });

    it("should fail with error if account is not valid", async () => {
      const address = "0xf97e180c050e5ab072211ad2c213eb5aee4df134";
      const stateRoot = Buffer.from("7c0f9a6f21d82c2d7690db7aa36c9938de11891071eed6e50ff8b06b5ae7018a", "hex");
      const proof: ELProof = {
        address: "0xf97e180c050e5ab072211ad2c213eb5aee4df134",
        accountProof: [
          "0xf90211a0d75d80002d4636755e0a3641ca53b495f0ccc3647af350ed23e86c4a9a21e089a0336a6387ac802d0d0433b65144610247ae2c4308b5f08683c641cddae571de52a0660dfa6b7ff69e6c4fe394e28c04097fd7c0d1e24d4d33731517ffeedeb73157a07d9a0299ad17ee459de4036254a522384bff041c32824761717abe82ed2250d5a0048f46242274fcfb2987dd9e1071335f966065322639b21a62a45ef9c4364707a06ab5c805de0350d7eb8641cfa3e985b58506529fc4f2175d018485b100fc8b57a030319f5efe302ba7d2cb593508af9e5b09eb8b961aac077f3e93e7c30d72b23aa08062584b94684d3585bc5cff5eb14ce8288cae9e6cca02d0145111fdeaec1ce8a05439df26136570dd0e3091ae189084e5445551e73de9032a589da1e858f493f7a074bfd76b5dfbaeb33d5caa06b0606eddfa9e2650b162a806e834535297a43f6fa0424651d0c1014d6575f418d84813d5fe61807162ae61eb9e2e29c099b62cff15a0717da7ec37ee17527323649684010b25b7fd7a53017645c92302aef90f66c696a0ce494b7c363d3ae8cca6fa9a6e60cf27b824f4e5acfa286b5b972d62e378d210a0861ef474c4cdeabd705bae1f3cc0a414129e7c2ad5c4fde69d5eea1757302046a0d8cc468f942d47cbc8349d221f958ae0505da2a4573db6a59859b743568cffcaa0fd6408c5b26aeba4d614d7043fd04082b9262e44dc966ad2c88add47b580325c80",
          "0xf90211a03aa3b28c58df0f2425569105f33d2b6f06682549a6086ca70e435e083bc86642a03177615c6149235d6c65e332ee7cc959b359d5dfdf9f6e3d29148d0f21aae9cba00357883423f1f4d1c5a21ef3c3bac9d87df1776aac962b1179c6ab4fa4c90eb1a0e5cdccfd420d7d0a115819805fc36372603d3a17ce1c8b3eb475d5c92f48090ea001b2c7e0885020c533a4bffc63735c409a118c774fa9927f56f54670de7a66bda054744b8c7e8ef96f30199b4038ea26467ea1803d205c2941e64a92a4b69f3457a0b3d5d0084572d60091cfd0e24a4ffba0b3fb53b53b9b6f91b0bb09714738ea46a052b016189553636fc18eaefd5ca00364dce332376a2988c936fa2527d15e215fa095f7f13944352c399335b7fe8971641db0e9922d9a91279e422f10cc75e16c26a0f5e63e53a4ab4157d7f3824747518d45567f1fab8fe1d41d569d33a97cb0e252a086928b3e984b0b92e24a8c27465e673e6c6336b7a9967b758e9a77ff92edb4e3a0bf10d9217a9bee1822e8f9edf82ac1d17725748fb9dcb0a16364da24bfbaa002a020eacf91465e7edefad05c0cc88c9209278edd213329f2f157969884985ecfaba02a195ddc556ebd100289d11ba8a6c54724bca5c93de0cec1e567f4f4537d952ca07237f43e3b1c16b5d7112fff823c08ffdd6891f4c9d2cb06b6300a0e3551f5faa0410d0b37714dbc23a76101f88a9b5876ab6d0d026391a2b456ea6bb245ef3c9680",
          "0xf90211a05cad7b7b1877521c405da0d0600be8f8dbfb6fe593fe7e0ff79b07cae70c0d44a04d7fa730f2cf4127121a4fbd783e97c372d00e2278f1475bd46df26ed1aba7e0a0d5368b792c687cfe7942dc1f9ece7941967d5a0b7d7c569c0dc3ec3c00cd8254a05c9f8de738470a1c962b38e95b32932afd26eae633f436960789acc024ac02c1a0b89a8e0ac2119c1ab9f40b233e2fb6878f7e41ccffa431c725d9e12c6589685ea059e306727f0c5c7ea0bc89ddbccd2d83ba5d9bc845a1be74e8677defcd0382a6a0a26aac0a6ff0f5e9e24eb6a0cc2d0813dd931d588941ce9ab4c74fd67bfe1b7fa07761bda76f79d20fc56a7f75d31295b3456fe001e12cb35bcd9cc12fdb5363faa07607ec1df2eca793d11953260a679a586793a1da4a55a2c8797741ee7ebd446ba0775277855b4d28645a7e3309d307616866e0df43f30255a5a8c0687430e0f0e4a0246affb48f550d0ea5f7b0ccdb14dd2b413356ae109d2522fd91379ecbe4c60ca0e82662910f79c26e9e5681ecbf79642fb02fe797ec7d17f23054543b00ef34dea0b6d81b91c67ac2db3e32d1556d6e6f699ce1cd7f2c0100be64c6264a0cd090d8a061a554d18934beddc75a67777326400ba6e254366d1ef59ee47bcfa91b3279e4a06f13cd680786a409ccbc9b84471b978a9efa02b09d1a64670ff6451a32d37b96a0e929123e076756fb6d43d668ddb199aca289b8c5869ec93842f1ef89c39c604f80",
          "0xf90211a028f2b0b77d46dd1a39fd0164d641b78e69ef29ce2ab676f02ee116d910b323cea0fcef9afa59d09cb714351378fd2c64becee3b1e9f09220687596670befb3a216a035d92a41b8e7e8c8f22abdce06272884cf1e53be96aa39a8aa722f97d0c8ea85a028b36435bf98dd8bac1edb6fc162737117320b000cd7609ec0d418e8dcad859ba062aaed887f8084e22f78779a671181c603cfeadc33629e4dc716fb4b8165d782a0180471c441c16211a8f2a3d9cc3859216965338971ece92d5386a972e6460c4ea0f3267b9acf4d4d47c8f563625c3f6a05e6d919312692945a28d44ada0408a8a4a0f157cf2e66744bb885c90b96b0ac50f45677262671224a4f754b1693930545b0a024db528d804e437bcbd74c6478d09fdcd95104bed7a110c01d89d4b24c283caea0f7ddca48dbfc34175322b37e35be0e10b7e8f0cf4b0f3c0c64ca4cc7409558a7a0fc03b71345f0f7c2c784b3e9bb8793c8358553eaa9811943af4b7e1ab827d64ca09db546d194941254910642424ed644cc13d27862d797faec1c73d72d4d1aff38a07ad68175fa8ccebae05aca2ac077b98f8906dfe1c01a526060d45948794badeba0383a06be4451de334f19162fd2f2b3a01ccaa318f0b19f6053c7f6274702a92ea0c92e0b54e5c7e5f6f18e0aa9762e09e911f0f519654b945103d517154125e695a0dcf537bda42520ce6670c2f3fb546ea12d28518f06310da26a9df887a1fc2a4880",
          "0xf90131a02fc4b4a237a100d29804e54134a3f590fe14cfc5932cf0d7db7d10b7c19359a580a07fb3394fdb1dc6cb6ee6bf74e16772783361840df5878b10284ef41f457a9cdda0b5d3f9bd4f88da36a3fbb68526053d7394f35411433bd88799510ce8a51e08dea0700e6a715dd6d428d31cbc9543cf768212e07692a79bd560e56d4f9547f3b6fb8080a0b295e4bf173f6a21ab742c03976070c3ba873b5fe457831de8411bf5ca988d08a057c069ca8e65fea0a889e16e770a7cc4f3125a35820deb3f0e6f8ae22e08d2eba0781511eba2101b49120073b03e24e79a3cdb0a02ee2d948e05a99a8b3b4145a4a011504843006186cba62c7f5563b3aee69c9f0325d6aadddc4c7c5ea246e50772a0ec6a3ac8944ef87fd684400258ef36a89194599884b606b032bedb29f42bcd008080808080",
          "0xf8729e31610ff568919eaebec883afe43d94f9558d9c666ca54b3d3bfef2311d37b851f84f0c8b034f248d17939c513a7e80a056e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421a0c5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
        ],
        balance: "0x34f248d17939c513a7e80",
        codeHash: "0xc5d2460186f7233c927e7db2dcc703c0e500b653ca82273b7bfad8045d85a470",
        nonce: "0xc",
        storageHash: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
        storageProof: [],
      };

      await expect(
        isValidAccount({
          proof,
          address,
          stateRoot,
        })
      ).rejectedWith("Invalid proof provided");
    });
  });

  describe("isValidStorageKeys", () => {
    it("should return true if storage keys are valid", async () => {
      const proof: ELStorageProof = {
        storageHash: "0x1b6a3261a5285e7d20f74f6f86134c894d395e39e15993eb4fad87a40f6af5e4",
        storageProof: [
          {
            key: "0xa934b07068f5d95a11413ed6d08a4a1122dc4b8c14a6ab2d94f8b279dac63042",
            value: "0x0",
            proof: [
              "0xf90211a035f929f33e4ff13e3c7a0f0cc1df0fd87ed58ac8a819091a0a1c05bb2f0cfc52a0d0ec64fd9c5883b3df24861cca332e437968ee38d98ec88670d09a235e94fd7aa0fcc64807aa553ac5e7e7ed716f5fb30b2af33a5e3e91ca60d7a5f2aa0dd6b0eca0edfd8d0f1559f25e5005ab9c2587f747a20e921145dc2cb276f717580ef49218a06066949aba34a1cdbc27e2a2de9f2673dd67a97729cadb8fd9e0be6bb8505e6da00023406388cbba918bd64aa14d6d1550f457aaaf212975d9ffa4a619363d8706a05b310a0ebf7270ef604b1f1c10f8e27dc1fc51b535715e3215f1ee04b47fe71ba01d1c1727fb02071b7350e1705cfcd88936d0465e4e075724e10cc6b0f1b18ef9a045e7acbb3d9f3a9886bad2befcebbc92ea7e338565ac76be3768e8da5bdbbf58a0d76ea3d82a08c5b565c7d6dffd7b9a8559006e8af04a264e8ae9c79ce729c3a7a0f1a8ba3190c4636f9570501509db1d209d8ac650b070a6a2ee973339b53efacca0e7c5ad879837168fd39cb45c986bffd8d3c99e487685213fef9fc54d06770e04a00556a20c4e9a24f2467ac80045c5d4c0671a2e79f9d475f12317119267b560f3a0c159b311bef30ab466930a3694c6ccc9ecf728332fb039aec3e49795f0469befa0ec31caaaa48bba20bbcf1c5b953ec47b491cd5c6903640e4102ce54613db19baa09e76eadd4788600b5b37b9dfb2e355802ac75ce65de5fb87e4d930974e5d3e2180",
              "0xf90211a0a7af35500f30484963b3168c62d7a86299e02b5cd0b698a541fc75a637611a80a0eaa57f45d3864fd735614b8c3de99875e8537e3d957b8647cbadcfe503965128a07caa21a62ef79a3cb87cb922cc267d5675d2dfed0487edc35d888846f63cf5e8a05179f38e0b309df3cca585eccb07a2df7d158eecb1dcde8792db7d99af6658e4a0fcf8de500c8c8659a762438d35c8a24e535a4f6156ef55095f2c9682eda15115a0542184034e298de70cad346481b45a38b8c4a68b01d864d3bc753c37cad8922ba0efb0e25dce2f783c3ed699971ffed4397250c1f8947c93902215e0c4d4284812a016a20023cf42f458b9207aaf3864266953dde6718f07837104ab19231c331af6a08ac356f497d61d607c566be1c85bd331b7a192d4bf4fd579b3b08b97e69b0c90a004e200625b0f83e93b8225f044090fc899957964dcccda7a62b54e1a8d5e6a79a0bdaa3c3b540ceb4faefd4415196fb9f997cbf7f6c0e3e5c4c0cb881dcbdbfb5ba0124e452071958a977fd7606712ed22f0b814f8d0e46f6e161a74d449c328bafaa077caef292e5b69ba5dd1779ac56b58c6a0410ae0bc3463ca964c281b99ae624ba05b2cc97bc76ec70df7de2d470a36d299dda926c64d6886e574911e8f7c8b2b42a0626fbd444bbee61a5bd65703d9f3b60a17faeedc48e74308f76130142b3b5471a0f9c47f1313d03542e8e845d0f1f03a84d5bf1bd8ec209b73b0570fff7764ce3b80",
              "0xf90211a0003d99fbd5ed6a3c36b3a94a7676f94e7320eb29f664d66350cef4e87e71d0a6a0e40b6e4d13bc2e79a1842c0459506e8d1eaf23c2abe6da8b652e9ac79887819ba082e41d8c0a86d81f229743c97ba23d0cfdcb348dc410a4d199c22b43954dc061a0ade1a10055a1b8dc66eb1d0b3f66533440f003a4b30435090cc737ccda7077c3a0a0391531281ea5fcfad3ac057627c3e5a7b26d8178fa3290db3d4bfeed426b17a0a18d4ea1516b9ce01b66a926e03cd545faef205594a9ab09ff181e4062900425a0aa0f007dc836777093c7a156c0a897b14b0cf31bbec89aea65df86f67e2a09c2a03973162b1b6133f91d10a420fb38d339f51f5b8e650d43a9644f82c17747b6f7a0429b1a67530253c5ef6d90799cefceea90d7623e7dc666d0611364feec413d40a0f5f898635d366ab1e1cc762044dc128879632b3463859a3b25e83796cf1c9bcda060ae20f12695ddcf0dcbf8c197314960faaf2b8a4a5d2ecb9a2c449d9dccd880a032b52c3864ece34069e471bd44057e066c80696db9755c1df264ce86c6aa9ee1a032b7170ee13afc61011dfad9d0df2c07dea31a3c316f6af67b94f00f044e1c7fa0ca5e38fbc4de6dad4903623374f29d92ea5ed65551f606f0f28261b0c773160fa009d43e3e4c62b2e15d7dd43ae54a2fc8708d24cd2cec9eafd69141a0d872f64aa03724b18354a914bd8d51cf2314d7c24f43319ab481ca16f49e70e77d74cbb51a80",
              "0xf90211a048fdea9831823100a1666ec3f96d5a00d2f37a8a868a747e68021d88670290eca04646b8016c0e7af43ad1c940b3a5712f1c6ac58fbda60bde92b6016e931177f3a0b6b0831b8cf22b5174aa27fd4c544bcc0871bb168608d295cbd9b7f8d1ca079ba02801d39deb1c357535be4d33faaf8de67427e9811618fe479a24e76fe4811d12a0a8cf036b716b82b1fa92913d96d9c6a241b50b38bc8cae5ab9372b7a9fa3dfcea0377aba70aacf837b1e564f4b43e46176efcdd903f4cec79a537638513afaafe0a06e0d9903116d936bc8f961885433c183d1d4bc3508a60289cf05ad1b60f7f5e6a077875df7cc2ad0f68179dde7e0f6368febd10910ed53d21d00e0fcc507371342a07c511ff39ef9256b52e15888b132139226e1b2e224ae23e38df76b4d06a95544a0ca56d3fec4ca10d7cf0a5c0aabab6817e035e9659b7778d9a88a5dae4722db12a08f8c8c721d135838e16dbd50c4712841dd470088c244f509752bcff920253364a082ece15a206f20af75cf7242bc86e1bed19f54b19b6033d38b841bd896fd1933a0680e28a5de96750595091a9dd272aa9ff14ba945e146d179325267b7bf6f6508a081fe9eb2ce69e888a70a56d72568eb0e4891af7f20d4dd8f612280d0ca23cf40a0fa411cb7b0ec0a8f66bbd8253482161c7d01afed481a2777bf24793f36f71b22a027005997273df6d06aea5ad7de32f03713b0b482e805f9fcd83afd8c59d8848580",
              "0xf90211a02747d543c8a3410efd989fa588c47d2507c9861bdec29574d4854653f6fc3ea6a072d4a756f1068e020f8f92bba67e0138bca21f12f6aca57dfdc2cc8a3d5e879aa063943cd42f578736b6298145ec83caa1d754a1088a188fae7cf4f47c61db4b10a08f71f34254ecc5537cc20a2f4a0f2af820a1dcca58dd3591e734eb53def4e67fa09f3f6123a8eb258afed0dd8975dab70f18e272e891a991c8df9822c8d0db20e5a089dcf67f4dad3b2d9cdb2bae92e6c00ec513e550f676b5810c25a98965307f02a0309d0894cf155124874ae733160c8dde21ea7edb97dd73e1bab37975933c4e83a0849e9985e2a24b8dc933ea58a6fde011c3860a1b246d372d47171cf54e1b2cf0a08f4d56cdabf06696c2ecf01a18c1df56897bc917e87d5372789d579801db445ea0f51d5ce538ee11f8d47b3734341b21d10503ce1252eab6d19cb3b153c5ff6f8ba0ede4a747adc81cea257ae5e7e9b3cbb32f5e10d146c78e9220ace7971ee147f4a0e20ab73cad6db6a50ef9db3905cfb48e332641f68e6cad00c7b4355c6bd20b7aa0c592be83fa9438fc7badb7cac1d852a54b0c730919ecb61ea39453f6958c1260a08bfccb533b082b21c4f3c0309eaca036037bd92ccfccfab95a1e14090862c8d1a091eb455f1fab1864a4fafc77d01887549131084fd8e9256fe506b556d873d4c3a0e442ec67b6d98eb50d369580dadcfe8e824f9cfa4f029269d2838137b3c614c080",
              "0xf87180808080a08b5c90a6d4b6e4e89f1c192579185789fc3ffc6f8a17dac49c3053865934fca0808080a006c198dc3c6142b298108fee66b5688269b86a4a30429c43e53355699a765dda8080a007c901ff1e048505f63dbfb895b6a85403ff1b921066e12bfbc3878f803e909c8080808080",
            ],
          },
        ],
      };
      const storageKeys = ["0xa934b07068f5d95a11413ed6d08a4a1122dc4b8c14a6ab2d94f8b279dac63042"];

      await expect(
        isValidStorageKeys({
          proof,
          storageKeys,
        })
      ).eventually.to.be.true;
    });

    it("should fail with error for a wrong proof", async () => {
      const proof: ELStorageProof = {
        storageHash: "0x1b6a3261a5285e7d20f74f6f86134c894d395e39e15993eb4fad87a40f6af5e4",
        storageProof: [
          {
            key: "0xa934b07068f5d95a11413ed6d08a4a1122dc4b8c14a6ab2d94f8b279dac63042",
            value: "0x0",
            proof: [
              "0xe90211a035f929f33e4ff13e3c7a0f0cc1df0fd87ed58ac8a819091a0a1c05bb2f0cfc52a0d0ec64fd9c5883b3df24861cca332e437968ee38d98ec88670d09a235e94fd7aa0fcc64807aa553ac5e7e7ed716f5fb30b2af33a5e3e91ca60d7a5f2aa0dd6b0eca0edfd8d0f1559f25e5005ab9c2587f747a20e921145dc2cb276f717580ef49218a06066949aba34a1cdbc27e2a2de9f2673dd67a97729cadb8fd9e0be6bb8505e6da00023406388cbba918bd64aa14d6d1550f457aaaf212975d9ffa4a619363d8706a05b310a0ebf7270ef604b1f1c10f8e27dc1fc51b535715e3215f1ee04b47fe71ba01d1c1727fb02071b7350e1705cfcd88936d0465e4e075724e10cc6b0f1b18ef9a045e7acbb3d9f3a9886bad2befcebbc92ea7e338565ac76be3768e8da5bdbbf58a0d76ea3d82a08c5b565c7d6dffd7b9a8559006e8af04a264e8ae9c79ce729c3a7a0f1a8ba3190c4636f9570501509db1d209d8ac650b070a6a2ee973339b53efacca0e7c5ad879837168fd39cb45c986bffd8d3c99e487685213fef9fc54d06770e04a00556a20c4e9a24f2467ac80045c5d4c0671a2e79f9d475f12317119267b560f3a0c159b311bef30ab466930a3694c6ccc9ecf728332fb039aec3e49795f0469befa0ec31caaaa48bba20bbcf1c5b953ec47b491cd5c6903640e4102ce54613db19baa09e76eadd4788600b5b37b9dfb2e355802ac75ce65de5fb87e4d930974e5d3e2180",
              "0xf90211a0a7af35500f30484963b3168c62d7a86299e02b5cd0b698a541fc75a637611a80a0eaa57f45d3864fd735614b8c3de99875e8537e3d957b8647cbadcfe503965128a07caa21a62ef79a3cb87cb922cc267d5675d2dfed0487edc35d888846f63cf5e8a05179f38e0b309df3cca585eccb07a2df7d158eecb1dcde8792db7d99af6658e4a0fcf8de500c8c8659a762438d35c8a24e535a4f6156ef55095f2c9682eda15115a0542184034e298de70cad346481b45a38b8c4a68b01d864d3bc753c37cad8922ba0efb0e25dce2f783c3ed699971ffed4397250c1f8947c93902215e0c4d4284812a016a20023cf42f458b9207aaf3864266953dde6718f07837104ab19231c331af6a08ac356f497d61d607c566be1c85bd331b7a192d4bf4fd579b3b08b97e69b0c90a004e200625b0f83e93b8225f044090fc899957964dcccda7a62b54e1a8d5e6a79a0bdaa3c3b540ceb4faefd4415196fb9f997cbf7f6c0e3e5c4c0cb881dcbdbfb5ba0124e452071958a977fd7606712ed22f0b814f8d0e46f6e161a74d449c328bafaa077caef292e5b69ba5dd1779ac56b58c6a0410ae0bc3463ca964c281b99ae624ba05b2cc97bc76ec70df7de2d470a36d299dda926c64d6886e574911e8f7c8b2b42a0626fbd444bbee61a5bd65703d9f3b60a17faeedc48e74308f76130142b3b5471a0f9c47f1313d03542e8e845d0f1f03a84d5bf1bd8ec209b73b0570fff7764ce3b80",
              "0xf90211a0003d99fbd5ed6a3c36b3a94a7676f94e7320eb29f664d66350cef4e87e71d0a6a0e40b6e4d13bc2e79a1842c0459506e8d1eaf23c2abe6da8b652e9ac79887819ba082e41d8c0a86d81f229743c97ba23d0cfdcb348dc410a4d199c22b43954dc061a0ade1a10055a1b8dc66eb1d0b3f66533440f003a4b30435090cc737ccda7077c3a0a0391531281ea5fcfad3ac057627c3e5a7b26d8178fa3290db3d4bfeed426b17a0a18d4ea1516b9ce01b66a926e03cd545faef205594a9ab09ff181e4062900425a0aa0f007dc836777093c7a156c0a897b14b0cf31bbec89aea65df86f67e2a09c2a03973162b1b6133f91d10a420fb38d339f51f5b8e650d43a9644f82c17747b6f7a0429b1a67530253c5ef6d90799cefceea90d7623e7dc666d0611364feec413d40a0f5f898635d366ab1e1cc762044dc128879632b3463859a3b25e83796cf1c9bcda060ae20f12695ddcf0dcbf8c197314960faaf2b8a4a5d2ecb9a2c449d9dccd880a032b52c3864ece34069e471bd44057e066c80696db9755c1df264ce86c6aa9ee1a032b7170ee13afc61011dfad9d0df2c07dea31a3c316f6af67b94f00f044e1c7fa0ca5e38fbc4de6dad4903623374f29d92ea5ed65551f606f0f28261b0c773160fa009d43e3e4c62b2e15d7dd43ae54a2fc8708d24cd2cec9eafd69141a0d872f64aa03724b18354a914bd8d51cf2314d7c24f43319ab481ca16f49e70e77d74cbb51a80",
              "0xf90211a048fdea9831823100a1666ec3f96d5a00d2f37a8a868a747e68021d88670290eca04646b8016c0e7af43ad1c940b3a5712f1c6ac58fbda60bde92b6016e931177f3a0b6b0831b8cf22b5174aa27fd4c544bcc0871bb168608d295cbd9b7f8d1ca079ba02801d39deb1c357535be4d33faaf8de67427e9811618fe479a24e76fe4811d12a0a8cf036b716b82b1fa92913d96d9c6a241b50b38bc8cae5ab9372b7a9fa3dfcea0377aba70aacf837b1e564f4b43e46176efcdd903f4cec79a537638513afaafe0a06e0d9903116d936bc8f961885433c183d1d4bc3508a60289cf05ad1b60f7f5e6a077875df7cc2ad0f68179dde7e0f6368febd10910ed53d21d00e0fcc507371342a07c511ff39ef9256b52e15888b132139226e1b2e224ae23e38df76b4d06a95544a0ca56d3fec4ca10d7cf0a5c0aabab6817e035e9659b7778d9a88a5dae4722db12a08f8c8c721d135838e16dbd50c4712841dd470088c244f509752bcff920253364a082ece15a206f20af75cf7242bc86e1bed19f54b19b6033d38b841bd896fd1933a0680e28a5de96750595091a9dd272aa9ff14ba945e146d179325267b7bf6f6508a081fe9eb2ce69e888a70a56d72568eb0e4891af7f20d4dd8f612280d0ca23cf40a0fa411cb7b0ec0a8f66bbd8253482161c7d01afed481a2777bf24793f36f71b22a027005997273df6d06aea5ad7de32f03713b0b482e805f9fcd83afd8c59d8848580",
              "0xf90211a02747d543c8a3410efd989fa588c47d2507c9861bdec29574d4854653f6fc3ea6a072d4a756f1068e020f8f92bba67e0138bca21f12f6aca57dfdc2cc8a3d5e879aa063943cd42f578736b6298145ec83caa1d754a1088a188fae7cf4f47c61db4b10a08f71f34254ecc5537cc20a2f4a0f2af820a1dcca58dd3591e734eb53def4e67fa09f3f6123a8eb258afed0dd8975dab70f18e272e891a991c8df9822c8d0db20e5a089dcf67f4dad3b2d9cdb2bae92e6c00ec513e550f676b5810c25a98965307f02a0309d0894cf155124874ae733160c8dde21ea7edb97dd73e1bab37975933c4e83a0849e9985e2a24b8dc933ea58a6fde011c3860a1b246d372d47171cf54e1b2cf0a08f4d56cdabf06696c2ecf01a18c1df56897bc917e87d5372789d579801db445ea0f51d5ce538ee11f8d47b3734341b21d10503ce1252eab6d19cb3b153c5ff6f8ba0ede4a747adc81cea257ae5e7e9b3cbb32f5e10d146c78e9220ace7971ee147f4a0e20ab73cad6db6a50ef9db3905cfb48e332641f68e6cad00c7b4355c6bd20b7aa0c592be83fa9438fc7badb7cac1d852a54b0c730919ecb61ea39453f6958c1260a08bfccb533b082b21c4f3c0309eaca036037bd92ccfccfab95a1e14090862c8d1a091eb455f1fab1864a4fafc77d01887549131084fd8e9256fe506b556d873d4c3a0e442ec67b6d98eb50d369580dadcfe8e824f9cfa4f029269d2838137b3c614c080",
              "0xf87180808080a08b5c90a6d4b6e4e89f1c192579185789fc3ffc6f8a17dac49c3053865934fca0808080a006c198dc3c6142b298108fee66b5688269b86a4a30429c43e53355699a765dda8080a007c901ff1e048505f63dbfb895b6a85403ff1b921066e12bfbc3878f803e909c8080808080",
            ],
          },
        ],
      };
      const storageKeys = ["0xa934b07068f5d95a11413ed6d08a4a1122dc4b8c14a6ab2d94f8b279dac63042"];

      await expect(
        isValidStorageKeys({
          proof,
          storageKeys,
        })
      ).rejectedWith("Invalid proof provided");
    });

    it("should fail with error for a non existance key", async () => {
      const proof: ELStorageProof = {
        storageHash: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
        storageProof: [
          {
            key: "0xf97e180c050e5ab072211ad2c213eb5aee4df134",
            value: "0x0",
            proof: [],
          },
        ],
      };
      const storageKeys = ["0xa934b07068f5d95a11413ed6d08a4a1122dc4b8c14a6ab2d94f8b279dac63042"];

      await expect(
        isValidStorageKeys({
          proof,
          storageKeys,
        })
      ).rejectedWith("Invalid proof provided");
    });

    it("should return true empty keys", async () => {
      const proof: ELStorageProof = {
        storageHash: "0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421",
        storageProof: [],
      };
      const storageKeys: string[] = [];

      await expect(
        isValidStorageKeys({
          proof,
          storageKeys,
        })
      ).eventually.to.be.true;
    });
  });
});
